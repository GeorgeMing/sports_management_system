<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.3.2.min.js"></script>
    <script type="text/javascript">
        function GetXmlHttpObject()//是解决为不同浏览器创建不同 XMLHTTP 对象的问题
        {
            var xmlHttp=null;
            try {
                xmlHttp=new XMLHttpRequest();
            }
            catch (e) {
                try {
                    xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
                }
                catch (e) {
                    xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
            }
            return xmlHttp;
        }
        var size=0;//记录查询出来的行数
        function stateChanged()//接收php处理后返回的数据
        {
            if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete") {
                size=xmlHttp.responseText;//用响应文本填充 txtHint 占位符 txtHint 的内容
//                alert(size);
                var index=$("#col_name").val();//获得输入字段的值
                $th = $("<th>"+index+"</th>");//注意变量在html中的插入方式
                $("#table233 thead tr").append($th);//在thead中的所有tr中,在末尾添加一个th

                $col = $("<td><input type='text'></td>");//td 填写成绩
                $("#table233 tbody tr:not(:gt("+size+"))").prev().append($col);//在tbody中的所有tr中,除了最后一个,都在末尾添加一个tr

                $del = $("<td id='"+num+"'><input type='button' value='删除列' onclick='del_col(this)'></td>");//删除按钮
                $("#table233 tbody tr:eq("+size+")").append($del);

                $proportion = $("<td><input type='text'></td>");//成绩比例
                $("#table233 tbody tr:last").append($proportion);
            }
        }

        var num=1;//统计有多少个新添加进去的列,便于遍历删除
        function del_col(obj)
        {
            var obj_p=obj.parentNode;//终于找到td
            var index=document.getElementById(String(obj_p.getAttribute("id"))).cellIndex;//算出这个单元格在这一行上的位置
            index=index+1;
            $("#table233 thead tr th::nth-child("+index+")").remove();//删除表头
            $("#table233 tbody tr td::nth-child("+index+")").remove();//删除表格数据
        }
        function ajax_add(){
            var str = "a";
            var url="__URL__/test_table_ajax";//定义要发送到服务器的 URL（文件名）
            url=url+"?q="+str;//把带有输入域内容的参数 (q) 添加到这个 URL
            url=url+"&sid="+Math.random();//添加一个随机数，以防服务器使用缓存文件
            xmlHttp=GetXmlHttpObject();//调用 GetXmlHttpObject 函数来创建 XMLHTTP 对象
            xmlHttp.open("GET",url,true);//用给定的 URL 来打开打开这个 XMLHTTP 对象
            xmlHttp.send(null);//向服务器发送 HTTP 请求
            xmlHttp.onreadystatechange=stateChanged;//在事件被触发时告知该对象执行名为 stateChanged 的函数
        }
        function add_col()
        {
        }
    </script>
</head>
<body>
<table id="table233" border="1">
    <thead>
    <tr>
        <th>课程</th>
        <th>学号</th>
        <th>姓名</th>
        <th>性别</th>
        <th>总成绩</th>
    </tr>
    </thead>
    <tbody>
    <input type="hidden" id="size" value="<?php echo 233; ?>">
        <form>
            <volist name="data_size" id="qwe">
                <h1>{$qwe}</h1>
            </volist>
            <volist name="data" id="qwe">
            <tr>
                <td>{$qwe[coursename]}</td>
                <td>{$qwe[no]}</td>
                <td>{$qwe[name]}</td>
                <td>{$qwe[sex]}</td>
                <td>{$qwe[score]}</td>
            </tr>
            </volist>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td><input id="col_name" type="text" value="列名" ></td>
                <td id="0"><input type="button" value="添加列" onClick="ajax_add(this)"></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td>成绩比例:</td>
                <td>100%</td>
            </tr>

        </form>

    </tbody>
</table>
</body>
</html>